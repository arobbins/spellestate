var ENDA_BUNDLERATE={};(function(a){ENDA_BUNDLERATE.updateLayerNames=function(c){var b=0,d=c.find("tr.rate_row");d.each(function(){a(this).find("input").each(function(){var e=a(this).attr("name").replace(/rates\]\[\d\]/,"rates]["+b+"]");a(this).attr("name",e)});b+=1});return};ENDA_BUNDLERATE.updateStartCount=function(d){var c,b=d.parents("tr.rate_row").first(),e=b.next();if(d.hasClass("remove_bundle_layer")){c=parseInt(b.prev().find("input").first().val())+1}else{c=parseInt(d.val())+1}e.find("span.start_count").first().text(c)};ENDA_BUNDLERATE.toggleSpecificCountries=function(b){if(b.val()==="specific"){b.parent().next("div").show()}else{b.parent().next("div").hide()}};ENDA_BUNDLERATE.addLayer=function(e){if(e.attr("disabled")==="disabled"){return false}var c=this,d=e.parents("table").first(),b=d.find("tbody tr.rate_row").last(),f={action:"get_new_layer",start_count:parseInt(b.prev().find("input").first().val())+1,cost_input:b.find("input").last().attr("name"),products_input:b.find("input").first().attr("name")};a.post(ajaxurl,f,function(g){a(g).insertBefore(b);c.updateLayerNames(d)});return false};ENDA_BUNDLERATE.removeLayer=function(b){var c=b.parents("table").first();this.updateStartCount(b);b.parents("tr").first().remove();this.updateLayerNames(c);return false};ENDA_BUNDLERATE.disableAddLayerButton=function(c){var b=c.find("tr.rate_row input").first().val();if(!b||"0"===b||""===b){c.find(".add_layer").first().attr("disabled",true)}};ENDA_BUNDLERATE.addConfiguration=function(b){var d=a("#bundle_rate_configuration > tbody > tr"),c={action:"get_new_configuration_layer",index:d.length};a.post(ajaxurl,c,function(e){a(e).insertAfter(d.last());ENDA_BUNDLERATE.init()});return false};ENDA_BUNDLERATE.init=function(){var b=this;a(".shipping_destination .destination").on("change",function(){b.toggleSpecificCountries(a(this))}).change();a("select.chosen_select").chosen();a(".shipping_rates table").each(function(){b.disableAddLayerButton(a(this))})};a(document).ready(function(){var b=ENDA_BUNDLERATE;b.init();a("#bundle_rate_configuration").on("click",".add_layer",function(){return b.addLayer(a(this))}).on("click",".remove_bundle_layer",function(){return b.removeLayer(a(this))}).on("change","input.bundle_rate_products",function(){b.updateStartCount(a(this));if(!a(this).val()||"0"===a(this).val()||""===a(this).val()){a(this).parents("table").find(".add_layer").first().attr("disabled",true)}else{a(this).parents("table").find(".add_layer").first().attr("disabled",false)}}).on("click",".add_configuration",function(){return b.addConfiguration(a(this))})})})(jQuery);